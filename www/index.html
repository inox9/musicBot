<!DOCTYPE html>
<html>
<head>
	<title>Releases Bot v0.11 Queue</title>
	<meta http-equiv='Content-type' content='text/html; charset=utf8'/>
	<link href='http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css' rel='stylesheet'/>
	<link rel="stylesheet" href="media/messi.min.css" />
	<script src='http://code.jquery.com/jquery-2.0.3.min.js'></script>
	<script src="media/messi.js"></script>
	<style type='text/css'>
	#input { width: 500px; }
	</style>
	<script type='text/javascript'>
	getRels = function() {
		$('#releases').empty()
		$.getJSON('api.php', {'action': 'get'}, function(data) {
			var ignored = ['state', 'releasePage']
			rows = $.map(data, function (item, i) {
				tr = $('<tr>')
				if (item.state == 1) tr.addClass('warning')
				else if (item.state == 2) tr.addClass('success')
				$.each(item, function (k, v) {
					if ($.inArray(k, ignored) < 0) {
						td = $('<td>')
						v != null ? td.html(v + (k == 'id' ? '.' : '')) : td.html('N/A')
						tr.append(td)
					}
				})
				return tr
			})
			$('#releases').append(rows)
		}).fail(function(data) {
    		Messi.alert(data)
		})
	}
	$(function() {
		$('#add').click(function() {
			if ($('#input').val().length < 4) {
				Messi.alert('Недопустимая длина запроса')
				return;
			}
			$.post('api.php', $('#frm').serialize(), function(data) {
				if (data == 'OK') {
					Messi.alert('Ожидаемый релиз добавлен успешно!')
					getRels()
				} else Messi.alert(data)
			})
		})
		getRels()
	})
	</script>
</head>
<body>
	<div class='container'>
		<div class="page-header">
			<h1>Music Scene Releases Bot v0.1 <small>scenelog crawler &amp; downloader</small></h1>
		</div>
		<h3 class='text-center'>Добавить ожидаемый релиз</h3>
		<form class='form-inline text-center' role='form' id='frm'>
			<input type='hidden' name='action' value='add'>
			<div class='form-group'>
				<input class="form-control input-lg" type="text" placeholder="введите ключевые слова..." id='input' name='keywords'>
			</div>
			<div class='form-group'>
				<button type="button" class="btn btn-primary btn-lg" id='add'><span class="glyphicon glyphicon-plus"></span> Добавить</button>
			</div>
		</form>
		<h3 class='text-center'>Ожидаемые релизы</h3>
		<table class='table table-condensed table-hover' id='releases'></table>
	</div>
</body>
</html>

